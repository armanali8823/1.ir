<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ø³Ø§Ù…Ø§Ù†Ù‡ Ú©Ø¯Ú¯Ø°Ø§Ø±ÛŒ ÙˆØ³Ø§ÛŒÙ„ Ø´Ø±Ú©Øª Ú¯Ø³ØªØ±Ø¯Ù‡ Ú©Ø§Ù… Ù¾ÙˆÛŒØ§ Ø¬Ù‡Ø´</title>
<style>
  body {
    font-family: Tahoma, sans-serif;
    direction: rtl;
    background-color: #f0f0f0;
    padding: 20px;
    text-align: center;
  }
  .container {
    background: #fff;
    max-width: 700px;
    margin: 20px auto;
    padding: 25px 30px;
    border-radius: 10px;
    box-shadow: 0 0 10px #ccc;
  }
  form {
    display: flex;
    flex-direction: column;
    gap: 15px;
    align-items: flex-start;
  }
  label {
    font-weight: bold;
    margin-bottom: 5px;
  }
  input {
    padding: 7px 10px;
    border: 1px solid #ccc;
    border-radius: 6px;
    font-size: 14px;
    width: 100%;
    direction: ltr;
    box-sizing: border-box;
  }
  button {
    background-color: #4CAF50;
    border: none;
    color: white;
    padding: 9px 18px;
    font-size: 16px;
    cursor: pointer;
    border-radius: 6px;
    align-self: center;
    display: flex;
    align-items: center;
    gap: 6px;
  }
  button.search-btn {
    background-color: #0288d1;
    margin-bottom: 10px;
    padding: 10px 25px;
  }
  button.export-btn {
    background-color: #f57c00;
    margin-bottom: 20px;
    padding: 10px 25px;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 15px;
  }
  th, td {
    border: 1px solid #aaa;
    padding: 8px;
    font-size: 14px;
  }
  th {
    background: #eee;
  }
  .action-btn {
    background-color: #2196F3;
    border: none;
    color: white;
    padding: 5px 10px;
    margin: 2px;
    border-radius: 4px;
    cursor: pointer;
  }
  .delete-btn {
    background-color: #f44336;
  }
  .save-btn {
    background-color: #4caf50;
  }
  .cancel-btn {
    background-color: #9e9e9e;
  }
</style>

<!-- Ø§ÙØ²ÙˆØ¯Ù† Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡ SheetJS Ø¨Ø±Ø§ÛŒ Ø§Ú©Ø³Ù„ -->
<script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>

</head>
<body>

<h2>Ú©Ø¯Ú¯Ø°Ø§Ø±ÛŒ ÙˆØ³Ø§ÛŒÙ„ Ø´Ø±Ú©Øª Ú¯Ø³ØªØ±Ø¯Ù‡ Ú©Ø§Ù… Ù¾ÙˆÛŒØ§ Ø¬Ù‡Ø´</h2>

<button class="search-btn" type="button" onclick="searchItems()">ğŸ” Ø¬Ø³ØªØ¬Ùˆ</button>
<button class="export-btn" type="button" onclick="exportToExcel()">ğŸ“¥ Ø®Ø±ÙˆØ¬ÛŒ Ø§Ú©Ø³Ù„</button>

<div class="container">
  <form id="itemForm" onsubmit="return addItem(event)">
    <label for="shelfNumber">Ø´Ù…Ø§Ø±Ù‡ Ù‚ÙØ³Ù‡:</label>
    <input type="text" id="shelfNumber" name="shelfNumber" required />

    <label for="itemNumber">Ø´Ù…Ø§Ø±Ù‡ ÙˆØ³ÛŒÙ„Ù‡:</label>
    <input type="number" id="itemNumber" name="itemNumber" required />

    <label for="itemQuantity">Ù…Ù‚Ø¯Ø§Ø±:</label>
    <input type="number" id="itemQuantity" name="itemQuantity" placeholder="" min="0" step="any" />

    <label for="itemUnit">ÙˆØ§Ø­Ø¯:</label>
    <input type="text" id="itemUnit" name="itemUnit" placeholder="" />

    <label for="itemName">Ù†Ø§Ù… ÙˆØ³ÛŒÙ„Ù‡:</label>
    <input type="text" id="itemName" name="itemName" required />

    <label for="itemModel">Ù…Ø¯Ù„ ÙˆØ³ÛŒÙ„Ù‡:</label>
    <input type="text" id="itemModel" name="itemModel" />

    <button type="submit" title="Ø«Ø¨Øª ÙˆØ³ÛŒÙ„Ù‡">Ø«Ø¨Øª ÙˆØ³ÛŒÙ„Ù‡ â•</button>
  </form>
</div>

<table id="itemsTable" dir="rtl">
  <thead>
    <tr>
      <th>Ú©Ø¯ ÙˆØ³ÛŒÙ„Ù‡</th>
      <th>Ø´Ù…Ø§Ø±Ù‡ Ù‚ÙØ³Ù‡</th>
      <th>Ø´Ù…Ø§Ø±Ù‡ ÙˆØ³ÛŒÙ„Ù‡</th>
      <th>Ù…Ù‚Ø¯Ø§Ø±</th>
      <th>ÙˆØ§Ø­Ø¯</th>
      <th>Ù†Ø§Ù… ÙˆØ³ÛŒÙ„Ù‡</th>
      <th>Ù…Ø¯Ù„ ÙˆØ³ÛŒÙ„Ù‡</th>
      <th>Ø¹Ù…Ù„ÛŒØ§Øª</th>
    </tr>
  </thead>
  <tbody>
    <!-- Ø±Ø¯ÛŒÙ Ù‡Ø§ Ø§ÛŒÙ†Ø¬Ø§ Ø§Ø¶Ø§ÙÙ‡ Ù…ÛŒØ´Ù† -->
  </tbody>
</table>

<script>
  let items = [];
  let nextId = 1;

  function addItem(event) {
    event.preventDefault();

    const shelfNumber = document.getElementById('shelfNumber').value.trim();
    const itemNumber = document.getElementById('itemNumber').value.trim();
    const itemQuantity = document.getElementById('itemQuantity').value.trim();
    const itemUnit = document.getElementById('itemUnit').value.trim();
    const itemName = document.getElementById('itemName').value.trim();
    const itemModel = document.getElementById('itemModel').value.trim();

    if (!shelfNumber || !itemNumber || !itemName) {
      alert('Ù„Ø·ÙØ§ ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Ø¶Ø±ÙˆØ±ÛŒ Ø±Ø§ Ù¾Ø± Ú©Ù†ÛŒØ¯.');
      return false;
    }

    items.push({
      id: nextId++,
      shelfNumber,
      itemNumber,
      itemQuantity,
      itemUnit,
      itemName,
      itemModel
    });

    renderTable(items);
    event.target.reset();
    return false;
  }

  function renderTable(list) {
    const tbody = document.querySelector('#itemsTable tbody');
    tbody.innerHTML = '';

    list.forEach(item => {
      if (item.isEditing) {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${item.id}</td>
          <td><input type="text" id="edit_shelfNumber_${item.id}" value="${item.shelfNumber}" /></td>
          <td><input type="number" id="edit_itemNumber_${item.id}" value="${item.itemNumber}" /></td>
          <td><input type="number" id="edit_itemQuantity_${item.id}" value="${item.itemQuantity || ''}" step="any" min="0" /></td>
          <td><input type="text" id="edit_itemUnit_${item.id}" value="${item.itemUnit || ''}" /></td>
          <td><input type="text" id="edit_itemName_${item.id}" value="${item.itemName}" /></td>
          <td><input type="text" id="edit_itemModel_${item.id}" value="${item.itemModel || ''}" /></td>
          <td>
            <button class="action-btn save-btn" onclick="saveEdit(${item.id})">Ø°Ø®ÛŒØ±Ù‡</button>
            <button class="action-btn cancel-btn" onclick="cancelEdit(${item.id})">Ø§Ù†ØµØ±Ø§Ù</button>
          </td>
        `;
        tbody.appendChild(tr);
      } else {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${item.id}</td>
          <td>${item.shelfNumber}</td>
          <td>${item.itemNumber}</td>
          <td>${item.itemQuantity || '-'}</td>
          <td>${item.itemUnit || '-'}</td>
          <td>${item.itemName}</td>
          <td>${item.itemModel || '-'}</td>
          <td>
            <button class="action-btn" onclick="startEdit(${item.id})">ÙˆÛŒØ±Ø§ÛŒØ´</button>
            <button class="action-btn delete-btn" onclick="deleteItem(${item.id})">Ø­Ø°Ù</button>
          </td>
        `;
        tbody.appendChild(tr);
      }
    });
  }

  function deleteItem(id) {
    if(confirm('Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø§ÛŒÙ† Ù…ÙˆØ±Ø¯ Ø±Ø§ Ø­Ø°Ù Ú©Ù†ÛŒØ¯ØŸ')) {
      items = items.filter(i => i.id !== id);
      renderTable(items);
    }
  }

  function startEdit(id) {
    items = items.map(i => {
      if(i.id === id) {
        return {...i, isEditing: true};
      }
      return {...i, isEditing: false};
    });
    renderTable(items);
  }

  function cancelEdit(id) {
    items = items.map(i => {
      if(i.id === id) {
        const copy = {...i};
        delete copy.isEditing;
        return copy;
      }
      return i;
    });
    renderTable(items);
  }

  function saveEdit(id) {
    const shelfNumber = document.getElementById(`edit_shelfNumber_${id}`).value.trim();
    const itemNumber = document.getElementById(`edit_itemNumber_${id}`).value.trim();
    const itemQuantity = document.getElementById(`edit_itemQuantity_${id}`).value.trim();
    const itemUnit = document.getElementById(`edit_itemUnit_${id}`).value.trim();
    const itemName = document.getElementById(`edit_itemName_${id}`).value.trim();
    const itemModel = document.getElementById(`edit_itemModel_${id}`).value.trim();

    if (!shelfNumber || !itemNumber || !itemName) {
      alert('Ù„Ø·ÙØ§ ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Ø¶Ø±ÙˆØ±ÛŒ Ø±Ø§ Ù¾Ø± Ú©Ù†ÛŒØ¯.');
      return;
    }

    items = items.map(i => {
      if(i.id === id) {
        return {
          id,
          shelfNumber,
          itemNumber,
          itemQuantity,
          itemUnit,
          itemName,
          itemModel
        };
      }
      return i;
    });

    renderTable(items);
  }

  function searchItems() {
    const searchTerm = prompt('Ø´Ù…Ø§Ø±Ù‡ Ù‚ÙØ³Ù‡ØŒ Ù†Ø§Ù… ÙˆØ³ÛŒÙ„Ù‡ØŒ Ù…Ù‚Ø¯Ø§Ø± ÛŒØ§ ÙˆØ§Ø­Ø¯ Ø¨Ø±Ø§ÛŒ Ø¬Ø³ØªØ¬Ùˆ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:');
    if (searchTerm !== null) {
      const term = searchTerm.trim().toLowerCase();
      const filtered = items.filter(i =>
        i.shelfNumber.toLowerCase().includes(term) ||
        i.itemName.toLowerCase().includes(term) ||
        (i.itemQuantity && i.itemQuantity.toString().toLowerCase().includes(term)) ||
        (i.itemUnit && i.itemUnit.toLowerCase().includes(term))
      );
      if(filtered.length === 0){
        alert('Ù…ÙˆØ±Ø¯ÛŒ Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯.');
      }
      renderTable(filtered);
    }
  }

  function exportToExcel() {
    if(items.length === 0) {
      alert('Ù‡ÛŒÚ† Ø¯Ø§Ø¯Ù‡â€ŒØ§ÛŒ Ø¨Ø±Ø§ÛŒ Ø®Ø±ÙˆØ¬ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯.');
      return;
    }

    const ws_data = [
      ['Ú©Ø¯ ÙˆØ³ÛŒÙ„Ù‡', 'Ø´Ù…Ø§Ø±Ù‡ Ù‚ÙØ³Ù‡', 'Ø´Ù…Ø§Ø±Ù‡ ÙˆØ³ÛŒÙ„Ù‡', 'Ù…Ù‚Ø¯Ø§Ø±', 'ÙˆØ§Ø­Ø¯', 'Ù†Ø§Ù… ÙˆØ³ÛŒÙ„Ù‡', 'Ù…Ø¯Ù„ ÙˆØ³ÛŒÙ„Ù‡']
    ];

    items.forEach(item => {
      ws_data.push([
        item.id,
        item.shelfNumber,
        item.itemNumber,
        item.itemQuantity || '',
        item.itemUnit || '',
        item.itemName,
        item.itemModel || ''
      ]);
    });

    const ws = XLSX.utils.aoa_to_sheet(ws_data);

    const range = XLSX.utils.decode_range(ws['!ref']);

    // Ø§Ø³ØªØ§ÛŒÙ„ Ø¯Ø§Ø¯Ù† Ø¨Ù‡ Ù‡Ø¯Ø±Ù‡Ø§ (Ù¾Ø±Ø±Ù†Ú¯ Ùˆ ÙˆØ³Ø· Ú†ÛŒÙ† Ùˆ Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ Ø®Ø§Ú©Ø³ØªØ±ÛŒ)
    for(let C = range.s.c; C <= range.e.c; ++C) {
      const cell_address = XLSX.utils.encode_cell({r:0, c:C});
      if(!ws[cell_address]) continue;
      ws[cell_address].s = {
        font: { bold: true },
        fill: { fgColor: { rgb: "DDDDDD" } },
        alignment: { horizontal: "center", vertical: "center" },
        border: {
          top: {style:"thin", color: {auto:1}},
          right: {style:"thin", color: {auto:1}},
          bottom: {style:"thin", color: {auto:1}},
          left: {style:"thin", color: {auto:1}}
        }
      };
    }

    // Ø±Ø§Ø³Øª Ú†ÛŒÙ† Ú©Ø±Ø¯Ù† Ø¯Ø§Ø¯Ù‡ Ù‡Ø§ (Ø³Ø·Ø±Ù‡Ø§ÛŒ Ø¨Ø¹Ø¯ Ø§Ø² Ù‡Ø¯Ø±)
    for(let R = 1; R <= range.e.r; ++R) {
      for(let C = range.s.c; C <= range.e.c; ++C) {
        const cell_address = XLSX.utils.encode_cell({r:R, c:C});
        if(!ws[cell_address]) continue;
        ws[cell_address].s = {
          alignment: { horizontal: "right", vertical: "center" },
          border: {
            top: {style:"thin", color: {auto:1}},
            right: {style:"thin", color: {auto:1}},
            bottom: {style:"thin", color: {auto:1}},
            left: {style:"thin", color: {auto:1}}
          }
        };
      }
    }

    ws['!cols'] = [
      {wch: 10}, // Ú©Ø¯ ÙˆØ³ÛŒÙ„Ù‡
      {wch: 15}, // Ø´Ù…Ø§Ø±Ù‡ Ù‚ÙØ³Ù‡
      {wch: 15}, // Ø´Ù…Ø§Ø±Ù‡ ÙˆØ³ÛŒÙ„Ù‡
      {wch: 10}, // Ù…Ù‚Ø¯Ø§Ø±
      {wch: 10}, // ÙˆØ§Ø­Ø¯
      {wch: 25}, // Ù†Ø§Ù… ÙˆØ³ÛŒÙ„Ù‡
      {wch: 20}  // Ù…Ø¯Ù„ ÙˆØ³ÛŒÙ„Ù‡
    ];

    const wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb, ws, 'ÙˆØ³Ø§ÛŒÙ„');

    XLSX.writeFile(wb, 'items_export.xlsx');
  }
</script>

</body>
</html>
