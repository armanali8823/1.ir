<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ثبت اطلاعات دوربین</title>
<style>
    body {
        font-family: Tahoma, sans-serif;
        direction: rtl;
        background: #f5f5f5;
        padding: 20px;
        text-align: center;
    }
    h1 {
        margin-bottom: 20px;
        color: #333;
    }
    table {
        width: 100%;
        border-collapse: collapse;
        background: #fff;
        margin-top: 20px;
    }
    table, th, td {
        border: 1px solid #000;
    }
    th, td {
        padding: 8px;
        text-align: center;
    }
    input {
        padding: 8px;
        margin: 5px 0;
        width: 95%;
        max-width: 300px;
    }
    button {
        padding: 6px 12px;
        margin: 3px;
        cursor: pointer;
        border-radius: 8px;
        border: none;
        color: white;
    }
    .add-btn { background: #1976d2; }
    .add-btn:hover { background: #0d47a1; }
    .edit-btn { background: #fbc02d; color: black; }
    .edit-btn:hover { background: #f57f17; }
    .delete-btn { background: #d32f2f; }
    .delete-btn:hover { background: #b71c1c; }
    .excel-btn { background: #388e3c; }
    .excel-btn:hover { background: #1b5e20; }
    .clear-btn { background: #9e9e9e; }
    .clear-btn:hover { background: #616161; }
</style>
</head>
<body>

<h1>ثبت اطلاعات دوربین</h1>

<div>
    <input type="text" id="brand" placeholder="برند">
    <input type="text" id="model" placeholder="مدل">
    <input type="text" id="ip" placeholder="IP">
    <input type="text" id="mac" placeholder="MAC Address">
    <input type="text" id="number" placeholder="شماره">
    <input type="text" id="assetCode" placeholder="کد اموال">
    <br>
    <button class="add-btn" onclick="addData()">➕ افزودن</button>
</div>

<table id="dataTable">
    <thead>
        <tr>
            <th>برند</th>
            <th>مدل</th>
            <th>IP</th>
            <th>MAC Address</th>
            <th>شماره</th>
            <th>کد اموال</th>
            <th>عملیات</th>
        </tr>
    </thead>
    <tbody></tbody>
</table>

<button class="excel-btn" onclick="exportExcel()">📥 خروجی اکسل</button>
<button class="clear-btn" onclick="clearData()">🗑 پاک کردن همه</button>

<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script>
    let data = JSON.parse(localStorage.getItem("cameraData")) || [];
    let editIndex = null;

    function renderTable() {
        let tableBody = document.querySelector("#dataTable tbody");
        tableBody.innerHTML = "";
        data.forEach((item, index) => {
            let row = tableBody.insertRow();
            row.insertCell(0).innerText = item.برند;
            row.insertCell(1).innerText = item.مدل;
            row.insertCell(2).innerText = item.IP;
            row.insertCell(3).innerText = item["MAC Address"];
            row.insertCell(4).innerText = item.شماره;
            row.insertCell(5).innerText = item["کد اموال"];
            let actionsCell = row.insertCell(6);
            actionsCell.innerHTML = `
                <button class="edit-btn" onclick="editData(${index})">✏ ویرایش</button>
                <button class="delete-btn" onclick="deleteData(${index})">🗑 حذف</button>
            `;
        });
    }

    function addData() {
        let brand = document.getElementById("brand").value;
        let model = document.getElementById("model").value;
        let ip = document.getElementById("ip").value;
        let mac = document.getElementById("mac").value;
        let number = document.getElementById("number").value;
        let assetCode = document.getElementById("assetCode").value;

        if (!brand || !model || !ip || !mac || !number || !assetCode) {
            alert("لطفا همه فیلدها را پر کنید!");
            return;
        }

        let newData = {
            برند: brand,
            مدل: model,
            IP: ip,
            "MAC Address": mac,
            شماره: number,
            "کد اموال": assetCode
        };

        if (editIndex !== null) {
            data[editIndex] = newData;
            editIndex = null;
        } else {
            data.push(newData);
        }

        localStorage.setItem("cameraData", JSON.stringify(data));
        renderTable();
        clearInputs();
    }

    function editData(index) {
        let item = data[index];
        document.getElementById("brand").value = item.برند;
        document.getElementById("model").value = item.مدل;
        document.getElementById("ip").value = item.IP;
        document.getElementById("mac").value = item["MAC Address"];
        document.getElementById("number").value = item.شماره;
        document.getElementById("assetCode").value = item["کد اموال"];
        editIndex = index;
    }

    function deleteData(index) {
        if (confirm("آیا مطمئن هستید که می‌خواهید این ردیف را حذف کنید؟")) {
            data.splice(index, 1);
            localStorage.setItem("cameraData", JSON.stringify(data));
            renderTable();
        }
    }

    function clearData() {
        if (confirm("آیا مطمئن هستید که می‌خواهید همه داده‌ها را حذف کنید؟")) {
            data = [];
            localStorage.removeItem("cameraData");
            renderTable();
        }
    }

    function clearInputs() {
        document.getElementById("brand").value = "";
        document.getElementById("model").value = "";
        document.getElementById("ip").value = "";
        document.getElementById("mac").value = "";
        document.getElementById("number").value = "";
        document.getElementById("assetCode").value = "";
    }

    function exportExcel() {
        if (data.length === 0) {
            alert("هیچ داده‌ای برای خروجی وجود ندارد!");
            return;
        }
        let ws = XLSX.utils.json_to_sheet(data);
        for (let cell in ws) {
            if (cell[0] === '!') continue;
            ws[cell].s = { alignment: { horizontal: "right" } };
        }
        let wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, "دوربین‌ها");
        XLSX.writeFile(wb, "camera_data.xlsx");
    }

    renderTable();
</script>

</body>
</html>
