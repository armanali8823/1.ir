<!DOCTYPE html>

<html lang="fa">  
<head>  
  <meta charset="UTF-8" />  
  <meta name="viewport" content="width=device-width, initial-scale=1" />  
  <title>Ø³Ø§Ù…Ø§Ù†Ù‡ Ø­Ø¶ÙˆØ± Ùˆ ØºÛŒØ§Ø¨ Ø´Ø±Ú©Øª Ú¯Ø³ØªØ±Ø¯Ù‡ Ú©Ø§Ù… Ù¾ÙˆÛŒØ§ Ø¬Ù‡Ø´</title>  
  <style>  
    body {  
      font-family: Tahoma, sans-serif;  
      direction: rtl;  
      background-color: #f0f0f0;  
      padding: 20px;  
      text-align: center;  
    }  
    h2 { margin-bottom: 10px; }  
    table {  
      width: 100%;  
      border-collapse: collapse;  
      background: white;  
      margin-bottom: 20px;  
      table-layout: fixed;  
    }  
    th, td {  
      border: 1px solid #ccc;  
      padding: 8px 6px;  
      font-size: 14px;  
      vertical-align: middle;  
      word-wrap: break-word;  
    }  
    th {  
      background-color: #eee;  
    }  
    .btn {  
      padding: 6px 10px;  
      font-size: 13px;  
      border: none;  
      border-radius: 4px;  
      cursor: pointer;  
      user-select: none;  
      margin: 2px;  
    }  
    .btn:active { transform: scale(0.95); }  
    .delete-btn { background-color: #a50014; color: white; }  
    .status-btn { background-color: #ccc; color: #000; }  
    .status-btn.active1 { background-color: #158b00; color: white; }  
    .status-btn.active { background-color: #a50014; color: white; }  
    .save-btn {  
      background-color: #4caf50;  
      color: white;  
      font-size: 12px;  
      padding: 6px 12px;  
      border: none;  
      border-radius: 6px;  
      cursor: pointer;  
      float: left;  
      margin-bottom: 10px;  
      user-select: none;  
    }  
    .add-form {  
      background: white;  
      padding: 10px 12px;  
      border-radius: 8px;  
      box-shadow: 0 0 5px rgba(0,0,0,0.1);  
      max-width: 420px;  
      margin: 0 auto;  
      text-align: left;  
    }  
    .add-form input {  
      width: 120px;  
      padding: 6px;  
      font-size: 13px;  
      margin-left: 8px;  
      border: 1px solid #ccc;  
      border-radius: 5px;  
      text-align: center;  
    }  
    .add-form button.add-btn {  
      width: 90px;  
      padding: 6px 10px;  
      font-size: 13px;  
      background-color: #4caf50;  
      color: white;  
      border: none;  
      border-radius: 6px;  
      cursor: pointer;  
      margin-left: 8px;  
    }  
    /* ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¨Ø®Ø´ ÙˆØ±ÙˆØ¯ Ùˆ Ø®Ø±ÙˆØ¬ Ùˆ Ø¯Ú©Ù…Ù‡ Ø«Ø¨Øª Ú©Ù†Ø§Ø± Ø¢Ù† */  
    .time-cell div {  
      display: flex;  
      align-items: center;  
      justify-content: center;  
      gap: 6px;  
    }  
    .time-cell input {  
      width: 60px;  
      padding: 6px 8px;  
      font-size: 0.9rem;  
      border-radius: 5px;  
      border: 1px solid #ccc;  
      text-align: center;  
      flex-shrink: 0;  
    }  
    .time-register-btn {  
      padding: 4px 8px;  
      font-size: 12px;  
      cursor: pointer;  
      border-radius: 5px;  
      border: 1px solid #4caf50;  
      background-color: #a5d6a7;  
      color: #2e7d32;  
      user-select: none;  
      flex-shrink: 0;  
      transition: background-color 0.3s;  
    }  
    .time-register-btn:hover {  
      background-color: #81c784;  
    }  
    /* Ø§Ø³ØªØ§ÛŒÙ„ Ø¯Ú©Ù…Ù‡ Ø¨Ø§Ø²Ú¯Ø´Øª */  
    #backBtn {  
      margin-bottom: 15px;  
      padding: 6px 12px;  
      font-size: 14px;  
      border-radius: 6px;  
      border: 1px solid #ccc;  
      cursor: pointer;  
      background-color: #2196f3;  
      user-select: none;
        
    }  
    #backBtn:hover {  
      background-color: #ddd;
      text-color: white;
    } 
    /* Ø§Ø³ØªØ§ÛŒÙ„ Ú©Ø§Ù†ØªÛŒÙ†Ø± ØªØ§Ø±ÛŒØ® Ùˆ Ø¯Ú©Ù…Ù‡ Ø«Ø¨Øª */  
    #dateContainer {  
      margin-bottom: 20px;  
      display: inline-flex;  
      align-items: center;  
      gap: 8px;  
      justify-content: center;  
      width: 100%;  
    }  
    #dateInput {  
      width: 180px;  
      padding: 8px;  
      font-size: 14px;  
      border-radius: 6px;  
      border: 1px solid #ccc;  
      text-align: center;  
    }  
    #registerDateBtn {  
      width: 90px;  
      height: 34px;  
      padding: 0;  
    }  
  </style>  
</head>  
<body>  
  <a href="1.html"><button id="backBtn" onclick="history.back()">â† Ø¨Ø§Ø²Ú¯Ø´Øª</button></a>

  <h2>Ø­Ø¶ÙˆØ± Ùˆ ØºÛŒØ§Ø¨ Ø´Ø±Ú©Øª Ú¯Ø³ØªØ±Ø¯Ù‡ Ú©Ø§Ù… Ù¾ÙˆÛŒØ§ Ø¬Ù‡Ø´</h2>    <div id="dateContainer">  
    <input type="text" id="dateInput" placeholder="Ù…Ø«Ù„Ø§Ù‹ 1404/05/17" />  
    <button class="save-btn" id="registerDateBtn" onclick="registerDate()">Ø«Ø¨Øª ØªØ§Ø±ÛŒØ®</button>  
  </div>    <table>  
    <thead>  
      <tr>  
        <th>Ø±Ø¯ÛŒÙ</th>  
        <th>Ù†Ø§Ù…</th>  
        <th>Ø´ØºÙ„</th>  
        <th>ÙˆØ±ÙˆØ¯</th>  
        <th>Ø®Ø±ÙˆØ¬</th>  
        <th>Ø­Ø§Ø¶Ø±</th>  
        <th>ØºØ§ÛŒØ¨</th>  
        <th>Ø¹Ù…Ù„ÛŒØ§Øª</th>  
      </tr>  
    </thead>  
    <tbody id="employeeTable"></tbody>  
  </table>  <button class="save-btn" onclick="saveFinalData()">ğŸ’¾ Ø°Ø®ÛŒØ±Ù‡ Ú¯Ø²Ø§Ø±Ø´ Ø±ÙˆØ²Ø§Ù†Ù‡</button>

  <div class="add-form">  
    <input type="text" id="nameInput" placeholder="Ù†Ø§Ù… Ú©Ø§Ø±Ù…Ù†Ø¯" />  
    <input type="text" id="jobInput" placeholder="Ø´ØºÙ„ Ú©Ø§Ø±Ù…Ù†Ø¯" />  
    <button class="add-btn" onclick="addEmployee()">â• Ø§ÙØ²ÙˆØ¯Ù†</button>  
  </div>  <script>  
  let employees = JSON.parse(localStorage.getItem('employeeList')) || [];  
  
  function saveAndRender() {  
    localStorage.setItem('employeeList', JSON.stringify(employees));  
    renderTable();  
  }  
  
  function renderTable() {  
    const table = document.getElementById('employeeTable');  
    table.innerHTML = '';  
    employees.forEach((emp, index) => {  
      const row = document.createElement('tr');  
      row.innerHTML = `  
        <td>${index + 1}</td>  
        <td>${emp.name}</td>  
        <td>${emp.job}</td>  
        <td class="time-cell">  
          <div>  
            <input type="text" value="${emp.enter}" oninput="updateEnter(${index}, this.value)" ${emp.enter === '-' ? 'disabled' : ''} placeholder="Ù…Ø«Ù„Ø§Ù‹ 9:00" id="enterInput${index}" />  
            <button class="time-register-btn" onclick="registerCurrentTime(${index}, 'enter')">Ø«Ø¨Øª</button>  
          </div>  
        </td>  
        <td class="time-cell">  
          <div>  
            <input type="text" value="${emp.exit}" oninput="updateExit(${index}, this.value)" ${emp.exit === '-' ? 'disabled' : ''} placeholder="Ù…Ø«Ù„Ø§Ù‹ 17:00" id="exitInput${index}" />  
            <button class="time-register-btn" onclick="registerCurrentTime(${index}, 'exit')">Ø«Ø¨Øª</button>  
          </div>  
        </td>  
        <td><button class="btn status-btn ${emp.status === 'present' ? 'active1' : ''}" onclick="markStatus(${index}, 'present')">âœ” Ø­Ø§Ø¶Ø±</button></td>  
        <td><button class="btn status-btn ${emp.status === 'absent' ? 'active' : ''}" onclick="markStatus(${index}, 'absent')">âœ– ØºØ§ÛŒØ¨</button></td>  
        <td>  
          <button class="btn edit-btn" onclick="toggleEditRow(${index}, this)">âœï¸ ÙˆÛŒØ±Ø§ÛŒØ´</button>  
          <button class="btn delete-btn" onclick="deleteEmployee(${index})">ğŸ—‘ Ø­Ø°Ù</button>  
        </td>  
      `;  
      table.appendChild(row);  
    });  
  }  
  
  // Ø«Ø¨Øª Ø²Ù…Ø§Ù† ÙØ¹Ù„ÛŒ Ø³ÛŒØ³ØªÙ… Ø¨Ù‡ ØµÙˆØ±Øª HH:MM Ø¯Ø± ÙÛŒÙ„Ø¯ ÙˆØ±ÙˆØ¯ ÛŒØ§ Ø®Ø±ÙˆØ¬  
  function registerCurrentTime(index, field) {  
    const now = new Date();  
    const hh = ('0' + now.getHours()).slice(-2);  
    const mm = ('0' + now.getMinutes()).slice(-2);  
    const timeStr = `${hh}:${mm}`;  
  
    if (field === 'enter') {  
      employees[index].enter = timeStr;  
      document.getElementById(`enterInput${index}`).value = timeStr;  
    } else if (field === 'exit') {  
      employees[index].exit = timeStr;  
      document.getElementById(`exitInput${index}`).value = timeStr;  
    }  
    saveToLocal();  
  }  
  
  function toggleEditRow(index, btn) {  
    const row = document.querySelectorAll('#employeeTable tr')[index];  
    if (!row) return;  
  
    const editMode = btn.textContent === 'âœ” Ø°Ø®ÛŒØ±Ù‡';  
  
    if (editMode) {  
      const nameInput = row.cells[1].querySelector('input');  
      const jobInput = row.cells[2].querySelector('input');  
      if (!nameInput.value.trim() || !jobInput.value.trim()) {  
        alert('Ù†Ø§Ù… Ùˆ Ø´ØºÙ„ Ù†Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ù†Ø¯ Ø®Ø§Ù„ÛŒ Ø¨Ø§Ø´Ù†Ø¯!');  
        return;  
      }  
      employees[index].name = nameInput.value.trim();  
      employees[index].job = jobInput.value.trim();  
  
      const enterInput = row.cells[3].querySelector('input');  
      const exitInput = row.cells[4].querySelector('input');  
      employees[index].enter = enterInput.value.trim();  
      employees[index].exit = exitInput.value.trim();  
  
      saveAndRender();  
      btn.textContent = 'âœï¸ ÙˆÛŒØ±Ø§ÛŒØ´';  
    } else {  
      const nameTd = row.cells[1];  
      const jobTd = row.cells[2];  
      nameTd.innerHTML = `<input type="text" value="${employees[index].name}">`;  
      jobTd.innerHTML = `<input type="text" value="${employees[index].job}">`;  
      btn.textContent = 'âœ” Ø°Ø®ÛŒØ±Ù‡';  
    }  
  }  
  
  function updateEnter(index, value) {  
    employees[index].enter = value;  
    saveToLocal();  
  }  
  
  function updateExit(index, value) {  
    employees[index].exit = value;  
    saveToLocal();  
  }  
  
  function addEmployee() {  
    const name = document.getElementById('nameInput').value.trim();  
    const job = document.getElementById('jobInput').value.trim();  
  
    if (!name || !job) {  
      alert("Ù„Ø·ÙØ§Ù‹ Ù†Ø§Ù… Ùˆ Ø´ØºÙ„ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.");  
      return;  
    }  
  
    const exists = employees.some(emp => emp.name.toLowerCase() === name.toLowerCase());  
    if (exists) {  
      alert("Ú©Ø§Ø±Ù…Ù†Ø¯ Ø¨Ø§ Ø§ÛŒÙ† Ù†Ø§Ù… Ù‚Ø¨Ù„Ø§Ù‹ Ø«Ø¨Øª Ø´Ø¯Ù‡ Ø§Ø³Øª.");  
      return;  
    }  
  
    employees.push({ name, job, enter: '', exit: '', status: '' });  
    document.getElementById('nameInput').value = '';  
    document.getElementById('jobInput').value = '';  
    saveAndRender();  
  }  
  
  function markStatus(index, status) {  
    employees[index].status = status;  
    if (status === 'absent') {  
      employees[index].enter = '-';  
      employees[index].exit = '-';  
    } else {  
      if (employees[index].enter === '-') employees[index].enter = '';  
      if (employees[index].exit === '-') employees[index].exit = '';  
    }  
    saveAndRender();  
  }  
  
  function deleteEmployee(index) {  
    if (confirm("Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ")) {  
      employees.splice(index, 1);  
      saveAndRender();  
    }  
  }  
  
  function saveToLocal() {  
    localStorage.setItem('employeeList', JSON.stringify(employees));  
  }  
  
  function saveFinalData() {  
    const date = document.getElementById('dateInput').value.trim();  
    if (!date) {  
      alert("Ù„Ø·ÙØ§Ù‹ ØªØ§Ø±ÛŒØ® Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.");  
      return;  
    }  
    let history = JSON.parse(localStorage.getItem('attendanceHistory')) || {};  
    history[date] = [...employees];  
    localStorage.setItem('attendanceHistory', JSON.stringify(history));  
    alert("âœ… Ú¯Ø²Ø§Ø±Ø´ Ø±ÙˆØ²Ø§Ù†Ù‡ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯ Ø¨Ø±Ø§ÛŒ ØªØ§Ø±ÛŒØ®: " + date);  
  }  
  
  // Ú¯Ø±ÙØªÙ† ØªØ§Ø±ÛŒØ® Ø´Ù…Ø³ÛŒ Ø§Ù…Ø±ÙˆØ² Ø¨Ù‡ ØµÙˆØ±Øª yyyy/mm/dd  
  function getTodayPersianDate() {  
    const today = new Date();  
    const options = { year: 'numeric', month: '2-digit', day: '2-digit', calendar: 'persian' };  
    try {  
      return new Intl.DateTimeFormat('fa-IR-u-ca-persian', options).format(today);  
    } catch {  
      const y = today.getFullYear();  
      const m = ('0' + (today.getMonth() + 1)).slice(-2);  
      const d = ('0' + today.getDate()).slice(-2);  
      return `${y}/${m}/${d}`;  
    }  
  }  
  
  function registerDate() {  
    const dateInput = document.getElementById('dateInput');  
    const persianDate = getTodayPersianDate();  
    dateInput.value = persianDate;  
  
    localStorage.setItem('registeredDate', persianDate);  
    alert("ØªØ§Ø±ÛŒØ® Ø®ÙˆØ¯Ú©Ø§Ø± Ø«Ø¨Øª Ø´Ø¯: " + persianDate);  
  }  
  
  renderTable();  
</script>  </body>  
</html>  
